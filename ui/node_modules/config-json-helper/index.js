/**
*# (c) Copyright 2014 Hewlett-Packard Development Company, L.P.
*#
*#   Licensed under the Apache License, Version 2.0 (the "License");
*#   you may not use this file except in compliance with the License.
*#   You may obtain a copy of the License at
*#
*#       http://www.apache.org/licenses/LICENSE-2.0
*#
*#   Unless required by applicable law or agreed to in writing, software
*#   distributed under the License is distributed on an "AS IS" BASIS,
*#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
*#   See the License for the specific language governing permissions and
*#   limitations under the License.
*/
'use strict';

var nconf = require('nconf');

module.exports = {
  //Returns a Json object coming from config.json
  //example: var configJson = require('config-json-helper');
  //         console.log(configJson.get('site:node'));

  get: function(key){
    var r = '';
    try {
      nconf.use('file', { file: sails.config.env.config.location });
      nconf.load();
      r = nconf.get(key);
    } catch (error) {
      console.log(error);
    }
    return r;
  },
  //Returns node name String, empty String on error
  //example: ci.x7.dev.forj.io
  getNode: function(app){
    var r = '';
    try {
      nconf.use('file', { file: sails.config.env.config.location });
      nconf.load();
      var nodes = nconf.get('site:node');
      for (var i=0; i<nodes.length; i++){
        if (nodes[i]=="default"){
          continue;
        }
        // console.log(nodes[i].node_name);
        for (var j=0; j<nodes[i].tools.length; j++){
          // console.log("  " + nodes[i].tools[j].name);
          if (nodes[i].tools[j].name == app){
            r = nodes[i].node_name;
            break;
          }
        }
      }
    } catch (error) {
      console.error(error);
    }
    return r;
  },

  getIpBytool: function(tool){
    nconf.use('file', { file: sails.config.env.config.location });
    nconf.load();
    var nodes = nconf.get('site:node');
    var ip;
    for (var i=0; i<nodes.length; i++){
      if (nodes[i]=="default"){
        continue;
      }
      //console.log(nodes[i].node_name);
      for (var j=0; j<nodes[i].tools.length; j++){
        if (nodes[i].tools[j].name == tool){
          if (nodes[i].tools[j].tool_url != null ){
            ip = (nodes[i].tools[j].tool_url.replace(/[^0-9.]/g, ''));
          }
          else{
            ip = null;
          }
          break;
        }
      }
    }
    return ip;
  }
}